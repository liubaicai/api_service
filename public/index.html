<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <!--[if IE]>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <![endif]-->

    <title>菜园子 -刘白菜的个人博客</title>
    <meta name="description" content="" />
    <meta name="author" content="" />

    <link href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.css" rel="stylesheet">
    <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet" />

    <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
    <script src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.js"></script>
    <script src="//cdn.bootcss.com/vue/2.4.2/vue.js"></script>
    <script src="//cdn.bootcss.com/vue-resource/1.3.4/vue-resource.js"></script>
    <script src="js/vuejs-paginate.min.js"></script>
</head>
<body>
<div id="root">
    <div id="header">
        <div class="overlay">
            <div class="container">
                <div class="row">
                    <div class="col-md-4 logo-div">
                        <div class="logo-inner text-center">
                            <div class="logo-name">
                                <a href="/">
                                    <img src="http://tvax2.sinaimg.cn/crop.0.0.996.996.180/48d3d0daly8fg26fkwz99j20ro0rowhn.jpg" class="img-circle" />
                                </a>
                            </div>

                        </div>

                    </div>
                    <div class="col-md-8 header-text-top " id="about">



                        <h1>Nice responsive template for blogger.</h1>
                        This blogging template use bootstrap and html to create a very nice blogging page with great responsive. <br />
                        Here you can write a general notes about your blog.<br />
                        <h2><strong>Who I am ? </strong></h2>
                        <i>I am Jhon Deo </i>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">

        <div class="row">

            <div class="col-md-8 ">

                <div id="post-container">
                    <div v-for="article in articles" class="blog-post">
                        <h1>{{article.title}}</h1>
                        <div class="item-info">Posted by <span>{{admin}}</span> on {{getTime(article.created_at)}} </div>
                        <div class="item-content" v-html="article.text">{{article.text}}</div>
                        <a href="#">Read More <i class="fa fa-angle-right"></i></a>
                    </div>
                </div>

                <paginate
                        :page-count="pageCount"
                        :force-page="pageNo"
                        container-class="pagination"
                        prev-text="&laquo;"
                        next-text="&raquo;"
                        :click-handler="pageNoClick">
                </paginate>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-3" style="padding-top: 30px;">
                <div class="row">
                    <ul class="list-group">
                        <li class="list-group-item"><strong>友情链接|LINKS</strong></li>

                        <li v-for="link in links" @click="navTo(link.url)" class="list-group-item">{{link.title}}</li>
                    </ul>
                </div>
                <!--<div class="row">-->
                    <!--<h3>Advertising</h3>-->


                <!--</div>-->
            </div>

        </div>


    </div>

    <div class="footer-sec" style="margin-top: 0px;">
        <div class="container">
            <div class="row">
                <div class="col-md-12 foo-inner">
                    &copy; {{now_year}} {{domain}} | <span v-html="footer">{{footer}}</span>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    Vue.component('paginate', VuejsPaginate)
    var vm = new Vue({
        el: '#root',
        data: {
            articles:null,
            categories:null,
            links:null,
            pageNo:0,
            pageCount:1,
            admin:'刘白菜',
            email:'liushuai.baicai@hotmail.com',
            url:'http://www.liubaicai.net/',
            domain: 'liubaicai.net',
            footer: 'Powerby<a href="http://weibo.com/liubaicai" target="_blank">@刘白菜</a>，项目源码托管于<a href="https://github.com/liubaicai/baicai_rails_blog" target="_blank">GitHub</a>'
        },
        computed: {
            now_year: function () {
                var date = new Date();
                return date.getFullYear();
            }
        },
        created: function () {
            var that = this
            this.getArticles(that.getUrlKey('page')||1).then(function (data) {
                that.articles = data["data"];
                that.pageNo = (that.getUrlKey('page')||1)-1;
                that.pageCount = Math.ceil((data["total"])/(data["per_page"]));
            })
            this.getLinks().then(function (data) {
                that.links = data["data"]
            })
        },
        methods: {
            getArticles (page) {
                return Vue.http.get(`/api/articles?page=${page||1}&per_page=5`)
                    .then(function (data) {
                        if (data.status === 200) {
                            return data.body;
                        }
                    });
            },
            getCategories(){
                return Vue.http.get(`/api/categories`)
                    .then(function (data) {
                        if (data.status === 200) {
                            return data.body;
                        }
                    })
            },
            getLinks(){
                return Vue.http.get(`/api/links`)
                    .then(function (data) {
                        if (data.status === 200) {
                            return data.body;
                        }
                    })
            },
            getTime(strTime){
                return new Date(strTime).toDateString();
            },
            getUrlKey:function(name){
                return decodeURIComponent((new RegExp('[?|&]'+name+'='+'([^&;]+?)(&|#|;|$)').exec(location.href)||[,""])[1].replace(/\+/g,'%20'))||null;
            },
            navTo(url){
                window.location = url;
            },
            pageNoClick: function(pageNum) {
                this.navTo('/?page='+pageNum);
//                var that = this
//                this.getArticles(pageNum).then(function (data) {
//                    window.scrollTo(0,0);
//                    that.articles = data["data"];
//                    that.pageNo = 1;
//                    that.pageCount = Math.ceil((data["total"])/(data["per_page"]));
//                })
            }
        },
    })
</script>
</body>
</html>
